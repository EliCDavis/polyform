<!DOCTYPE html>

<html>

<head>
	<meta charset="utf-8" />
	<title>Polyform</title>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<script>
		// By default the ServiceWorker's scope will be "server/"
		navigator.serviceWorker
			.register('sw.js', { scope: window.location.pathname + "app/" })
			.then(registration => {
				console.log("register", registration)
				document.getElementById("status-display").innerText = "activated"

				const sw = registration.active ?? registration.installing ?? registration.waiting
				// setInterval(() => sw.postMessage(null), 15000)
				window.location.href = window.location.href + "app/"

				if (registration.active) {
					document.getElementById("status-display").innerText = "activated"
					window.location.href = window.location.href + "app/"
					return
				}

				sw.addEventListener('statechange', (event) => {
				    console.log('statechange')
					if (event.target.state === 'activated') {
	                    console.log('activated')
						document.getElementById("status-display").innerText = "activated"
						window.location.href = window.location.href + "app/"
					}
				})			
			})
	</script>
</head>

<body>
	<h1>Polyform</h1>
	<b id="status-display">Downloading...</b>
</body>

</html>
