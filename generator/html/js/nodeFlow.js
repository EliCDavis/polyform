(()=>{var d={FontFamily:"Courier New",Graph:{BackgroundColor:"#07212a"},Node:{FontColor:"#afb9bb",BackgroundColor:"#0c2b35",Title:{Color:"#154050",FontColor:"#afb9bb",Padding:5},BorderRadius:15,Border:{Idle:"#1c1c1c",MouseOver:"#8e8e8e",Grabbed:"white",Selected:"#6e6e6e"},Port:{FontColor:"#afb9bb"}},BoxSelect:{Color:"white",Size:1,Radius:2,LineDashLength:5},Widget:{FontColor:"#afb9bb",BackgroundColor:"#0f313c",Border:{Color:"#154050",Size:2,Radius:2},Hover:{BackgroundColor:"#195366"},Slider:{FillColor:"#07212A"},Button:{Click:{BackgroundColor:"#1f637a"}}},ContextMenu:{BackgroundColor:"#07212A",HighlightColor:"#205A6D",FontColor:"#afb9bb"},Note:{FontColor:"#afb9bb",FontSize:16,EntrySpacing:20,LineSpacing:5,DotSize:3,HeaderLineWidth:2,H1:{FontSize:32},H2:{FontSize:16},H3:{FontSize:16},CodeBlock:{BackgroundColor:"#0c2b35",Padding:16,BorderRadius:4}}};var tt=16,ot="black";function E(s,e){return{color:s?.color===void 0?e?.color:s?.color,size:s?.size===void 0?e?.size:s?.size,font:s?.font===void 0?e?.font:s?.font,style:s?.style===void 0?e?.style:s?.style,weight:s?.weight===void 0?e?.weight:s?.weight}}var A=class{#e;#t;#o;#n;#i;constructor(e){this.#e=e?.size===void 0?tt:e.size,this.#t=e?.color===void 0?ot:e.color,this.#o=e?.font===void 0?d.FontFamily:e.font,this.#n=e?.weight===void 0?"":e.weight,this.#i=e?.style===void 0?"":e.style}setupStyle(e,t){e.fillStyle=this.#t,e.font=this.#i+" "+this.#n+" "+this.#e*t+"px "+this.#o}getSize(){return this.#e}getFont(){return this.#o}measure(e,t,o,i){this.setupStyle(e,t);let n=e.measureText(o);i.x=n.width,i.y=n.actualBoundingBoxAscent+n.actualBoundingBoxDescent}setColor(e){this.#t=e}setSize(e){this.#e=e}setWeight(e){this.#n=e}};var Te=class{#e;#t;#o;#n;#i;constructor(e,t){this.#e=new Array,this.#t=0,this.#o=e,this.#n=t,this.#i=0}runIf(e,t){e&&this.run(t)}#r(){return this.#i>0}run(e){let t=this.#t;this.#i+=1,e(),this.#i-=1,this.#t=t}get(){if(!this.#r())throw new Error("can't use pool outside of running context");let e;return this.#e.length===this.#t?(e=this.#o(),this.#e.push(this.#o())):(e=this.#e[this.#t],this.#n(e)),this.#t++,e}},C=new Te(()=>({x:0,y:0}),s=>{s.x=0,s.y=0});function p(s,e){s.x=e.x,s.y=e.y}function ae(s,e,t){s.x=e.x-t.x,s.y=e.y-t.y}function ne(s,e,t){s.x=e.x+t.x,s.y=e.y+t.y}function g(){return{x:0,y:0}}function He(s,e){if(s.x>e.x){let t=e.x;e.x=s.x,s.x=t}if(s.y>e.y){let t=e.y;e.y=s.y,s.y=t}}function Oe(s,e){let t=!1;return C.run(()=>{let o=C.get(),i=C.get();p(o,s.Position),ne(i,o,s.Size),He(o,i);let n=C.get(),r=C.get();p(n,e.Position),ne(r,n,e.Size),He(n,r),t=o.x<=r.x&&i.x>=n.x&&o.y<=r.y&&i.y>=n.y}),t}function ze(s,e){return e.x=s.Position.x+s.Size.x/2,e.y=s.Position.y+s.Size.y/2,e}function x(s,e){let t=s.Position;return!(e.x<t.x||e.y<t.y||e.x>t.x+s.Size.x||e.y>t.y+s.Size.y)}var S=class{#e;#t;constructor(){this.#e=new Array,this.#t=0}Count(){return this.#t}Clear(){this.#t=0}At(e){return this.#e[e]}Push(e){this.#e.length===this.#t?this.#e.push(e):this.#e[this.#t]=e,this.#t++}ToArray(){let e=new Array(this.Count());for(let t=0;t<this.#t;t++)e[t]=this.#e[t];return e}};var Ge=30;var Ve=class{#e;#t;#o;group;constructor(e){this.#e=e?.name===void 0?"item":e.name,this.#t=e?.callback,this.#o=new A(e?.textStyle),this.group=e?.group}getName(){return this.#e}execute(){this.#t!==void 0&&this.#t()}},Fe=class{constructor(e){this.entries=e;this.#e=e.length*Ge}#e;height(){return this.#e}},ce=class{constructor(e,t,o){this.text=e;this.subMenu=t;this.item=o}click(){this.item?.execute()}};function Z(...s){let e={items:new Array,subMenus:new Array};for(let t=0;t<s.length;t++){let o=s[t];o!==void 0&&(o.items!==void 0&&(e.items=e.items?.concat(o.items)),o.subMenus!==void 0&&(e.subMenus=e.subMenus?.concat(o.subMenus)))}return e}var te=class{#e;#t;#o;#n;#i;#r;constructor(e){if(this.#i=new S,this.#e=e?.name===void 0?"menu":e?.name,this.#t=new Array,this.#o=new Array,this.#n=new A(E(e?.textStyle,{color:d.ContextMenu.FontColor})),this.#r=e?.group,e?.subMenus!==void 0)for(let t=0;t<e?.subMenus.length;t++)this.#o.push(new te(e?.subMenus[t]));if(e?.items!==void 0)for(let t=0;t<e?.items.length;t++)this.#t.push(new Ve(e?.items[t]));this.#s()}#s(){let e=new Map,t=new Array;t.push(new Array);for(let o=0;o<this.#t.length;o++){let i=0,n=this.#t[o];if(n.group!==void 0){let r=e.get(n.group);r!==void 0?i=r:(i=t.length,e.set(n.group,i),t.push(new Array))}t[i].push(new ce(this.#t[o].getName(),void 0,this.#t[o]))}for(let o=0;o<this.#o.length;o++){let i=0,n=this.#o[o];if(n.#r!==void 0){let r=e.get(n.#r);r!==void 0?i=r:(i=t.length,e.set(n.#r,i),t.push(new Array))}t[i].push(new ce(this.#o[o].getName(),this.#o[o],void 0))}this.#i.Clear();for(let o=0;o<t.length;o++){let i=t[o];i.length!==0&&this.#i.Push(new Fe(i))}}#l=0;#u(e,t){if(this.#l>0)return this.#l;let o=g();for(let i=0;i<this.#i.Count();i++){let n=this.#i.At(i);for(let r=0;r<n.entries.length;r++)this.#n.measure(e,t,n.entries[r].text,o),this.#l=Math.max(o.x,this.#l)}return this.#l}getName(){return this.#e}#d={Position:g(),Size:g()};#h;#a;render(e,t,o,i){let r=1.25*Ge,l=1.25*(this.#u(e,1.25)+20),h=0;for(let m=0;m<this.#i.Count();m++)h+=this.#i.At(m).height();h*=1.25,this.#d.Size.x=l,this.#d.Size.y=r,this.#d.Position.x=t.x,this.#d.Position.y=t.y,e.textAlign="left",e.fillStyle=d.ContextMenu.BackgroundColor,e.shadowColor="#000000",e.shadowBlur=5*1.25,e.beginPath(),e.roundRect(t.x,this.#d.Position.y,l,h,5*1.25),e.fill(),e.shadowBlur=0;let u=null,c=!1,f=0;for(let m=0;m<this.#i.Count();m++){let V=this.#i.At(m);for(let k=0;k<V.entries.length;k++){let F=V.entries[k];this.#d.Position.y=t.y+r*f;let G=!1;i!==void 0&&x(this.#d,i)&&(u=F,G=!0,F.subMenu!==void 0?(this.#h=F.subMenu,this.#a={x:t.x+l,y:this.#d.Position.y},c=!0):this.#h=void 0),(G||this.#h!==void 0&&F.subMenu===this.#h)&&(e.fillStyle=d.ContextMenu.HighlightColor,e.beginPath(),e.roundRect(t.x+r/10,this.#d.Position.y+r/10,l-r/5,r-r/5,5*1.25),e.fill()),this.#n.setupStyle(e,1.25),e.fillText(F.text,t.x+r/5,this.#d.Position.y+r/2),F.subMenu!==void 0&&(e.beginPath(),e.strokeStyle=d.ContextMenu.FontColor,e.lineWidth=1*1.25,e.lineTo(t.x+l-r/2.5,this.#d.Position.y+r/3),e.lineTo(t.x+l-r/4,this.#d.Position.y+r/2),e.lineTo(t.x+l-r/2.5,this.#d.Position.y+r-r/3),e.stroke()),f++}if(m!==this.#i.Count()-1){e.strokeStyle=d.ContextMenu.FontColor,e.lineWidth=.5*1.25,e.beginPath();let k=t.x+r/10,F=this.#d.Position.y+r;e.lineTo(k,F),e.lineTo(k+l-r/5,F),e.stroke()}}if(this.#h!==void 0){let m=this.#h.render(e,this.#a,1.25,i);m!==null?u=m:c||(this.#h=void 0)}return u}};var fe=class{#e;#t;#o;#n;#i;#r;#s;#l;#u;constructor(e,t,o,i,n,r,l){this.#o=e,this.#i=t,this.#r=o,this.#s=i,this.#l=n,this.#u=r,this.#e=!1,this.#t=g(),this.#n=g(),e.addEventListener("mousedown",this.#g.bind(this),!1),e.addEventListener("touchstart",this.#f.bind(this),!1),document.addEventListener("mouseup",this.#c.bind(this),!1),document.addEventListener("touchend",this.#c.bind(this),!1),e.addEventListener("mousemove",this.#h.bind(this),!1),e.addEventListener("touchmove",this.#a.bind(this),!1),e.addEventListener("drop",h=>{h.preventDefault(),console.log(h),h.dataTransfer?.items?[...h.dataTransfer.items].forEach((u,c)=>{if(u.kind==="file"){let f=u.getAsFile();f&&(l(f),console.log(f),console.log(`\u2026 file[${c}].name = ${f.name}`))}}):h.dataTransfer&&[...h.dataTransfer.files].forEach((u,c)=>{console.log(`\u2026 file[${c}].name = ${u.name}`)})}),e.addEventListener("dragover",h=>{h.preventDefault(),this.#r(this.#d(h))}),e.addEventListener("contextmenu",h=>{r(this.#d(h)),h.preventDefault()},!1)}#d(e){var t=this.#o.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}#h(e){let t=this.#d(e);if(this.#e){let o=g();ae(o,t,this.#n),this.#i(o)}this.#r(t),p(this.#n,t)}#a(e){let t=this.#o.getBoundingClientRect(),o={x:e.touches[0].clientX-t.left,y:e.touches[0].clientY-t.top};this.#r(o),this.#e&&this.#i({x:o.x-this.#t.x,y:o.y-this.#t.y}),p(this.#t,o)}#g(e){e.button===0&&(this.#e=!0,this.#s(this.#d(e),e.ctrlKey||e.shiftKey))}#f(e){this.#e=!0;let t=this.#o.getBoundingClientRect();this.#t.x=e.touches[0].clientX-t.left,this.#t.y=e.touches[0].clientY-t.top,this.#s(this.#t,!1)}#c(e){e.button===0&&(this.#e=!1,this.#l())}};function Me(s,e,t){return Math.min(Math.max(s,e),t)}function H(s){return Me(s,0,1)}function Ae(s){var e=s.toString(16);return e.length==1?"0"+e:e}function Ue(s){return"#"+Ae(Math.round(s.r*255))+Ae(Math.round(s.g*255))+Ae(Math.round(s.b*255))}function Ze(s){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);return e?{r:parseInt(e[1],16)/255,g:parseInt(e[2],16)/255,b:parseInt(e[3],16)/255}:null}function _e(s,e){if(s.s<=0){e.r=s.v,e.g=s.v,e.b=s.v;return}let t=s.h;t>=360&&(t=0),t/=60;let o=Math.round(t),i=t-o,n=s.v*(1-s.s),r=s.v*(1-s.s*i),l=s.v*(1-s.s*(1-i));switch(o){case 0:e.r=s.v,e.g=l,e.b=n;break;case 1:e.r=r,e.g=s.v,e.b=n;break;case 2:e.r=n,e.g=s.v,e.b=l;break;case 3:e.r=n,e.g=r,e.b=s.v;break;case 4:e.r=l,e.g=n,e.b=s.v;break;default:e.r=s.v,e.g=n,e.b=r;break}e.r=H(e.r),e.g=H(e.g),e.b=H(e.b)}function je(s,e){let t=0;for(var o=0;o<s.length;o++)t+=s.charCodeAt(o)*(o+1);let i=24;t=Math.round(t)%i;let n={h:t/(i-1)*360,s:e,v:1},r={r:0,g:0,b:0};return _e(n,r),Ue(r)}var se=class{#e;#t;#o;#n;#i;#r;#s;#l;#u;constructor(e,t,o){this.#e=e,this.#i=new Array,this.#r=t,this.#t=o?.name===void 0?"Port":o?.name,this.#s=o?.type===void 0?"":o?.type,this.#o={borderColor:o?.emptyStyle?.borderColor===void 0?"#1c1c1c":o.emptyStyle?.borderColor,fillColor:o?.emptyStyle?.fillColor===void 0?je(this.#s,.3):o.emptyStyle?.fillColor,borderSize:o?.emptyStyle?.borderSize===void 0?1:o.emptyStyle?.borderSize,size:o?.emptyStyle?.size===void 0?4:o.emptyStyle?.size},this.#n={borderColor:o?.filledStyle?.borderColor===void 0?"#1c1c1c":o.filledStyle?.borderColor,fillColor:o?.filledStyle?.fillColor===void 0?je(this.#s,1):o.filledStyle?.fillColor,borderSize:o?.filledStyle?.borderSize===void 0?1:o.filledStyle?.borderSize,size:o?.filledStyle?.size===void 0?5:o.filledStyle?.size},this.#l=new Array,o?.onConnectionAdded&&this.#l.push(o?.onConnectionAdded),this.#u=new Array,o?.onConnectionRemoved&&this.#u.push(o?.onConnectionRemoved)}addConnection(e){this.#i.push(e);for(let t=0;t<this.#l.length;t++)this.#l[t](e,this,this.#r,this.#e)}addConnectionAddedListener(e){e!==void 0&&this.#l.push(e)}addConnectionRemovedListener(e){e!==void 0&&this.#u.push(e)}clearConnection(e){let t=this.#i.indexOf(e);if(t>-1){this.#i.splice(t,1);for(let o=0;o<this.#u.length;o++)this.#u[o](e,this,this.#r,this.#e)}else console.error("no connection found to remove")}getDataType(){return this.#s}getPortType(){return this.#r}getDisplayName(){return this.#t}filledStyleColor(){return this.#n.fillColor===void 0?(console.error("There's no fill color!!!!!!!!!"),"black"):this.#n.fillColor}#d={Position:{x:0,y:0},Size:{x:0,y:0}};render(e,t,o,i){let n=this.#o;this.#i.length>0&&(n=this.#n);let r=n.size*o.zoom;return i&&x(this.#d,i)&&(r*=1.25,e.textAlign="center",e.fillText(this.#s,t.x,t.y+r*3)),this.#d.Position.x=t.x-r,this.#d.Position.y=t.y-r,this.#d.Size.x=r*2,this.#d.Size.y=r*2,e.strokeStyle=n.borderColor,e.fillStyle=n.fillColor,e.beginPath(),this.#r==="INPUTARRAY"?e.rect(t.x-r,t.y-r,r*2,r*2):e.arc(t.x,t.y,r,0,2*Math.PI),e.fill(),e.stroke(),this.#d}};function Ye(s,e){return{color:s?.color===void 0?e?.color:s?.color,size:s?.size===void 0?e?.size:s?.size}}var le=class{#e;#t;constructor(e){this.#e=e?.size===void 0?.5:e.size,this.#t=e?.color===void 0?"black":e.color}setupStyle(e,t){e.strokeStyle=this.#t,e.lineWidth=t*this.#e}setColor(e){this.#t=e}setSize(e){this.#e=e}size(){return this.#e}};function Q(s,e){return{radius:s?.radius===void 0?e?.radius:s?.radius,color:s?.color===void 0?e?.color:s?.color,border:Ye(s?.border,e?.border)}}var W=class{#e;#t;#o;constructor(e){this.#t=e?.color===void 0?"#CCCCCC":e.color,this.#e=e?.border===void 0?null:new le(e.border),this.#o=e?.radius===void 0?2:e.radius}#n(e,t,o,i){e.fillStyle=this.#t,this.#e?.setupStyle(e,o),e.beginPath(),e.roundRect(t.Position.x,t.Position.y,t.Size.x,t.Size.y,i),e.fill()}#i(e,t,o,i){this.#n(e,t,o,i),e.stroke()}Outline(e,t,o,i){this.#e?.setupStyle(e,o),e.beginPath(),e.roundRect(t.Position.x,t.Position.y,t.Size.x,t.Size.y,i),e.stroke()}Draw(e,t,o){this.#i(e,t,o,this.#o*o)}DrawRoundedTopOnly(e,t,o){this.#i(e,t,o,[this.#o*o*2,this.#o*o*2,0,0])}DrawUnderline(e,t,o){this.#n(e,t,o,[this.#o*o*2,this.#o*o*2,0,0]),e.beginPath(),e.moveTo(t.Position.x,t.Position.y+t.Size.y),e.lineTo(t.Position.x+t.Size.x,t.Position.y+t.Size.y),e.stroke()}borderSize(){return this.#e===null?0:this.#e.size()}radius(){return this.#o}setColor(e){this.#t=e}setBorderColor(e){this.#e===null?this.#e=new le({color:e}):this.#e.setColor(e)}};var We=({max:s,getValue:e,match:t})=>{let o=0;for(;o<=s;){let i=Math.floor((o+s)/2),n=e(i);if(n===t)return i;n<t?o=i+1:s=i-1}return s};function $e(s,e,t){let o=s.measureText(e).width,i="\u2026",n=s.measureText(i).width;if(o<=t||o<=n)return e;let r=We({max:e.length,getValue:l=>s.measureText(e.substring(0,l)).width,match:t-n});return e.substring(0,r)+i}function Xe(s,e,t){if(s.measureText(e).width<=t)return[e];let i=We({max:e.length,getValue:n=>s.measureText(e.substring(0,n)).width,match:t});for(let n=i-1;n>=1;n--)if(e.charAt(n)===" "){i=n+1;break}return[e.substring(0,i),e.substring(i)]}function qe(s,e,t){if(s.measureText(e).width<=t)return[e];let i=new Array,n=e;for(;n!=="";){let r=We({max:n.length,getValue:l=>s.measureText(n.substring(0,l)).width,match:t});if(r===n.length){i.push(n.substring(0,r));break}for(let l=r-1;l>=1;l--)if(n.charAt(l)===" "){r=l+1;break}i.push(n.substring(0,r)),n=n.substring(r)}return i}var w=class{#e;#t;#o;#n;constructor(e,t){this.#n=e,this.#e=!1,this.#t=g(),this.#o=new A(t),document.fonts.check(`16px "${this.#o.getFont()}"`)||document.fonts.addEventListener("loadingdone",o=>{this.#e=!1})}set(e){this.#n=e,this.#e=!1}get(){return this.#n}breakIntoLines(e,t){let o=new Array;this.#o.setupStyle(e,1);let i=qe(e,this.#n,t);if(i.length===1)return[this];for(let n=0;n<i.length;n++){let r=new w(i[n]);r.#o=this.#o,o.push(r)}return o}split(e){let t=this.#n.split(e),o=new Array;for(let i=0;i<t.length;i++){let n=new w(t[i]);n.#o=this.#o,o.push(n)}return o}splitAtIndex(e){let t=[new w(this.#n.substring(0,e)),new w(this.#n.substring(e,0))];for(let o=0;o<t.length;o++)t[o].#o=this.#o;return t}splitAtWidth(e,t){this.#o.setupStyle(e,1);let o=Xe(e,this.#n,t);if(o.length===1)return[this];let i=new Array;for(let n=0;n<o.length;n++){let r=new w(o[n]);r.#o=this.#o,i.push(r)}return i}#i(e){if(this.#e)return;this.#o.setupStyle(e,1);let t=e.measureText(this.#n);this.#t.x=t.width,this.#t.y=t.actualBoundingBoxAscent+t.actualBoundingBoxDescent,this.#e=!0}size(e,t,o){this.#i(e),p(o,this.#t),o.x*=t,o.y*=t}setColor(e){this.#o.setColor(e)}setSize(e){this.#o.setSize(e)}setWeight(e){this.#o.setWeight(e)}render(e,t,o){this.#o.setupStyle(e,t),e.fillText(this.#n,o.x,o.y)}style(){return this.#o}};var R=class{#e;#t;#o;#n;#i;#r;constructor(e){this.#e=e.title,this.#t=e.options,this.#o=e.content,this.#n=e.onClose,this.#i=e.buttonCSS===void 0?"flex-grow: 1; margin-right: 8px;":e.buttonCSS,this.#r=null}Hide(){this.#r!==null&&(document.body.removeChild(this.#r),this.#r=null)}Show(){this.#r=document.createElement("div"),this.#r.style.cssText="position:absolute;top:0;width:100%;display:flex;height:100%;justify-content:center;align-items:center;background-color:#00000070;",document.body.appendChild(this.#r);let e=document.createElement("div");e.style.cssText="background-color:#000;color:white;font-family:Verdana;border-radius:8px;padding:16px;",this.#r.appendChild(e);let t=document.createElement("h2");t.textContent=this.#e,t.style.cssText="margin-top:0;margin-bottom:16px;",e.appendChild(t),this.#o!==void 0&&e.appendChild(this.#o());let o=document.createElement("div");o.style.cssText="margin-top:16px;justify-content:space-around;align-items:center;flex-direction:row;display:flex;",e.appendChild(o);for(let i=0;i<this.#t.length;i++){let n=document.createElement("button");n.style.cssText=this.#i,n.textContent=this.#t[i],n.onclick=()=>{this.Hide(),this.#n!==void 0&&this.#n(this.#t[i])},o.appendChild(n)}}};function z(s,e){return{box:Q(s?.box,e?.box),text:E(s?.text,e?.text),textAlign:s?.textAlign===void 0?e?.textAlign:s?.textAlign,textBaseline:s?.textBaseline===void 0?e?.textBaseline:s?.textBaseline}}var B=class{#e;#t;#o;#n;constructor(e){this.#e=new W(e?.box),this.#t=new A(e?.text),this.#o=e?.textAlign===void 0?"center":e.textAlign,this.#n=e?.textBaseline===void 0?"middle":e.textBaseline}Draw(e,t,o,i){this.#e.Draw(e,t,o),e.textAlign=this.#o,e.textBaseline=this.#n,this.#t.setupStyle(e,o),e.fillText(i,t.Position.x+t.Size.x/2,t.Position.y+t.Size.y/2)}DrawUnderline(e,t,o,i){this.#e.DrawUnderline(e,t,o),e.textAlign=this.#o,e.textBaseline=this.#n,this.#t.setupStyle(e,o),e.fillText(i,t.Position.x+t.Size.x/2,t.Position.y+t.Size.y/2)}setTextColor(e){this.#t.setColor(e)}setBoxColor(e){this.#e.setColor(e)}setBorderColor(e){this.#e.setBorderColor(e)}};var v=150,N=25;var _=class{#e;#t;#o;#n;#i;#r;#s;constructor(e,t){this.#e=e,this.#t=t?.property,this.#n=new B(z(t?.idleBoxStyle,{box:{color:d.Widget.BackgroundColor,border:{size:d.Widget.Border.Size,color:d.Widget.Border.Color},radius:d.Widget.Border.Radius},text:{color:d.Widget.FontColor}})),this.#i=new B(z(t?.highlightBoxStyle,{box:{color:d.Widget.Hover.BackgroundColor,border:{size:d.Widget.Border.Size,color:d.Widget.Border.Color},radius:d.Widget.Border.Radius},text:{color:d.Widget.FontColor}})),this.Set(t?.value===void 0?0:t?.value),this.#s=t?.callback,this.#t!==void 0&&this.#e.addPropertyChangeListener(this.#t,(o,i)=>{this.Set(i)})}Size(){return{x:v,y:N}}Set(e){this.#o!==e&&(this.#o=e,this.#t!==void 0&&this.#e.setProperty(this.#t,this.#o),this.#s!==void 0&&this.#s(this.#o),this.#r=""+parseFloat(this.#o.toPrecision(6)))}ClickStart(){}ClickEnd(){let e=null,t="Set",o="Cancel";new R({title:"Set Number",options:[t,o],content:()=>{let n=document.createElement("div");return e=document.createElement("input"),e.type="number",e.valueAsNumber=this.#o,n.append(e),n},onClose:n=>{n!==t||e===null||this.Set(e.valueAsNumber)}}).Show()}Draw(e,t,o,i){let n={Position:{x:0,y:0},Size:{x:v*o,y:N*o}};p(n.Position,t);let r=this.#n;return i!==void 0&&x(n,i)&&(r=this.#i),r.DrawUnderline(e,n,o,this.#r),n}};var j=class{#e;#t;#o;#n;#i;#r;constructor(e){this.#e=e?.text===void 0?"Button":e?.text,this.#i=e?.callback,this.#r=!1,this.#t=new B(z(e?.idleStyle,{box:{color:d.Widget.BackgroundColor,border:{size:d.Widget.Border.Size,color:d.Widget.Border.Color}},text:{color:d.Widget.FontColor}})),this.#o=new B(z(e?.hoverStyle,{box:{color:d.Widget.Hover.BackgroundColor,border:{size:d.Widget.Border.Size,color:d.Widget.Border.Color}},text:{color:d.Widget.FontColor}})),this.#n=new B(z(e?.clickStyle,{box:{color:d.Widget.Button.Click.BackgroundColor,border:{size:d.Widget.Border.Size,color:d.Widget.Border.Color}},text:{color:d.Widget.FontColor}}))}Size(){return{x:v,y:N}}Draw(e,t,o,i){let n={Position:{x:0,y:0},Size:{x:v*o,y:N*o}};p(n.Position,t);let r=this.#t;return i!==void 0&&!this.#r&&x(n,i)&&(r=this.#o),this.#r&&(r=this.#n),r.Draw(e,n,o,this.#e),n}ClickStart(){this.#r=!0}ClickEnd(){this.#r=!1,this.#i!==void 0&&this.#i()}};function it(s){let e=Ze(s);return e===null||(e.r+e.g+e.b)/3>.5?"black":"white"}var Y=class{#e;#t;#o;#n;#i;#r;constructor(e,t){this.#e=e,this.#t=t?.property,this.#i=new B({box:{color:this.#o,border:{color:this.#n,size:d.Widget.Border.Size}},text:t?.textStyle}),this.Set(t?.value===void 0?"#000000":t?.value),this.#r=t?.callback,this.#t!==void 0&&this.#e.addPropertyChangeListener(this.#t,(o,i)=>{this.Set(i)})}Size(){return{x:v,y:N}}Set(e){this.#o!==e&&(this.#o=e,this.#r!==void 0&&this.#r(this.#o),this.#t!==void 0&&this.#e.setProperty(this.#t,this.#o),this.#n=it(this.#o),this.#i.setBoxColor(this.#o),this.#i.setBorderColor(this.#n),this.#i.setTextColor(this.#n))}ClickStart(){}ClickEnd(){let e=null;new R({title:"Set Color",options:["Set","Cancel"],content:()=>{let o=document.createElement("div");e=document.createElement("input"),e.type="color",e.value=this.#o,e.name="color",o.append(e);let i=document.createElement("label");return i.htmlFor="color",i.textContent="Color",o.append(i),o},onClose:o=>{o!=="Set"||e===null||this.Set(e.value)}}).Show()}Draw(e,t,o,i){let n={Position:{x:0,y:0},Size:{x:v*o,y:N*o}};return p(n.Position,t),this.#i.Draw(e,n,o,this.#o),n}};var $=class{#e;#t;#o;#n;#i;#r;#s;#l;#u;#d;#h;#a;#g;#f;#c;#m;constructor(e,t){this.#e=t?.min===void 0?0:t?.min,this.#t=t?.max===void 0?1:t?.max,this.#i=t?.snapIncrement,this.#s=t?.property,this.#n="",this.#u=t?.release,this.#h=t?.backgroundColor===void 0?d.Widget.BackgroundColor:t?.backgroundColor,this.#g=t?.fillColor===void 0?d.Widget.Slider.FillColor:t?.fillColor,this.#a=t?.borderColor===void 0?d.Widget.Border.Color:t?.borderColor,this.#d=new A(E(t?.textStyle,{color:d.Widget.FontColor})),this.#f=g(),this.#c=g(),this.#m=!1,t?.property!==void 0&&t?.property!==null&&e.addPropertyChangeListener(t.property,(o,i)=>{this.SetValue(i)}),this.SetValue(t?.value===void 0?0:t?.value),this.#l=t?.change}SetValue(e){let t=Me(e,this.#e,this.#t);this.#o!==t&&(this.#o=t,this.#s&&this.#r.setProperty(this.#s,this.#o),this.#n=this.#o.toFixed(3),this.#l!==void 0&&this.#l(this.#o))}Size(){return{x:v,y:N}}ClickStart(){this.#m=!0,p(this.#c,this.#f)}ClickEnd(){this.#m=!1,this.#u!==void 0&&this.#u(this.#o)}Draw(e,t,o,i){let n=v*o,r=N*o,l=d.Widget.Border.Size*o;e.fillStyle=this.#h,e.strokeStyle=this.#a,e.lineWidth=l,e.beginPath(),e.roundRect(t.x,t.y,n,r,d.Widget.Border.Radius*o),e.fill(),e.stroke();let h=H((this.#o-this.#e)/(this.#t-this.#e));if(e.fillStyle=this.#g,e.beginPath(),e.roundRect(t.x+l/2,t.y+l/2,n*h-l,r-l,d.Widget.Border.Radius*o),e.fill(),e.textAlign="center",e.textBaseline="middle",this.#d.setupStyle(e,o),e.fillText(this.#n,t.x+n/2,t.y+r/2),i!==void 0&&(p(this.#f,i),this.#m)){let u=t.x+l/2,c=u+n-l,m=H((this.#f.x-u)/(c-u))*(this.#t-this.#e)+this.#e;this.#i!==void 0&&(m=Math.round(m/this.#i)*this.#i),this.SetValue(m)}return{Position:{x:t.x,y:t.y},Size:{x:n,y:r}}}};function de(s){let e=null;return new R({title:s.title,options:["Set","Cancel"],content:()=>{let t=document.createElement("div");return e=document.createElement("input"),e.value=s.startingValue,t.append(e),t},onClose:t=>{if(t!=="Set"||e===null){s.onCancel&&s.onCancel();return}s.onUpdate(e.value)}})}var X=class{#e;#t;#o;#n;#i;#r;constructor(e,t){this.#i=e,this.#r=t?.property,this.#t=new B(z(t?.textBoxStyle,{box:{color:d.Widget.BackgroundColor,border:{size:d.Widget.Border.Size,color:d.Widget.Border.Color},radius:d.Widget.Border.Radius},text:{color:d.Widget.FontColor}})),this.#o=new B(z(t?.textBoxStyle,{box:{color:d.Widget.Hover.BackgroundColor,border:{size:d.Widget.Border.Size,color:d.Widget.Border.Color},radius:d.Widget.Border.Radius},text:{color:d.Widget.FontColor}})),this.Set(t?.value===void 0?"":t?.value),this.#n=t?.callback,this.#r!==void 0&&this.#i.addPropertyChangeListener(this.#r,(o,i)=>{this.Set(i)})}Size(){return{x:v,y:N}}Set(e){this.#e!==e&&(this.#e=e,this.#r!==void 0&&this.#i.setProperty(this.#r,this.#e),this.#n!==void 0&&this.#n(this.#e))}ClickStart(){}ClickEnd(){de({title:"Set String",startingValue:this.#e,onUpdate:t=>{this.Set(t)}}).Show()}Draw(e,t,o,i){let n={Position:{x:0,y:0},Size:{x:v*o,y:N*o}};p(n.Position,t);let r=this.#t;return i!==void 0&&x(n,i)&&(r=this.#o),r.DrawUnderline(e,n,o,$e(e,this.#e,n.Size.x-20*o)),n}};var ge=class{#e;#t;#o;#n;#i;constructor(e){this.#e=new B(z(e?.idle,{box:{color:d.Widget.BackgroundColor,border:{size:d.Widget.Border.Size,color:d.Widget.Border.Color}},text:{color:d.Widget.FontColor}})),this.#t=new B(z(e?.hover,{box:{color:d.Widget.Hover.BackgroundColor,border:{size:d.Widget.Border.Size,color:d.Widget.Border.Color}},text:{color:d.Widget.FontColor}})),this.#o=e?.lightColor===void 0?"#222222":e.lightColor,this.#n=e?.lightBorderColor===void 0?"black":e.lightBorderColor,this.#i=e?.lightBlur}Draw(e,t,o,i,n){let r=v*o,l=N*o,h={Position:{x:0,y:0},Size:{x:r,y:l}};p(h.Position,t);let u=this.#e;n!==void 0&&x(h,n)&&(u=this.#t),u.Draw(e,h,o,i);let c=Math.min(r,l);return e.strokeStyle=this.#n,e.fillStyle=this.#o,e.beginPath(),e.roundRect(t.x+c*.2,t.y+c*.2,c*.6,c*.6,d.Widget.Border.Radius*o),this.#i&&(e.shadowBlur=this.#i*o,e.shadowColor=this.#o),e.fill(),this.#i&&(e.shadowBlur=0),{Position:t,Size:{x:r,y:l}}}},q=class{#e;#t;#o;#n;#i;#r;#s;constructor(e,t){this.#e=e,this.#t=t?.property,this.#n=t?.text===void 0?"Toggle":t?.text,this.#i=new ge({idle:z(t?.enabledStyle?.idle,{box:{color:d.Widget.BackgroundColor,border:{size:d.Widget.Border.Size,color:d.Widget.Border.Color}},text:{color:d.Widget.FontColor}}),lightBorderColor:t?.enabledStyle?.lightBorderColor,lightColor:t?.enabledStyle?.lightColor===void 0?"#00FF00":t?.enabledStyle?.lightColor,lightBlur:t?.enabledStyle?.lightBlur===void 0?15:t?.enabledStyle?.lightBlur}),this.#r=new ge({idle:z(t?.disabledStyle?.idle,{box:{color:d.Widget.BackgroundColor,border:{size:d.Widget.Border.Size,color:d.Widget.Border.Color}},text:{color:d.Widget.FontColor}}),lightBorderColor:t?.disabledStyle?.lightBorderColor,lightColor:t?.disabledStyle?.lightColor===void 0?"#004400":t?.enabledStyle?.lightColor}),this.Set(t?.value===void 0?!1:t?.value),this.#s=t?.callback,this.#t!==void 0&&this.#e.addPropertyChangeListener(this.#t,(o,i)=>{this.Set(i)})}Size(){return{x:v,y:N}}Draw(e,t,o,i){return(this.#o?this.#i:this.#r).Draw(e,t,o,this.#n,i)}Toggle(){this.Set(!this.#o)}Set(e){this.#o!==e&&(this.#o=e,this.#t!==void 0&&this.#e.setProperty(this.#t,this.#o),this.#s!==void 0&&this.#s(this.#o))}ClickStart(){this.Toggle()}ClickEnd(){}};var K=class{#e;#t;#o;#n;constructor(e){this.#o=e?.maxWidth===void 0?150:e?.maxWidth,this.#n=e?.maxHeight===void 0?150:e?.maxHeight,e?.image?this.SetUrl(e?.image):e?.blob&&this.SetBlob(e?.blob)}SetBlob(e){let o=(window.URL||window.webkitURL).createObjectURL(e);this.SetUrl(o)}SetUrl(e){this.#t=void 0,this.#e=e;let t=document.createElement("img");t.src=e,t.onload=()=>{this.#t=t},t.onerror=o=>{console.log("error loading image:",e,o)}}Size(){if(this.#t===void 0)return{x:0,y:0};let e=1;if(this.#t.width>this.#o&&(e=this.#o/this.#t.width),this.#t.height>this.#n){let t=this.#n/this.#t.height;t<e&&(e=t)}return{x:e*this.#t.width,y:e*this.#t.height}}ClickStart(){}ClickEnd(){}Draw(e,t,o,i){let n=this.Size(),r={Position:{x:0,y:0},Size:{x:n.x*o,y:n.y*o}};return p(r.Position,t),this.#t&&e.drawImage(this.#t,t.x,t.y,r.Size.x,r.Size.y),r}};var me=class{#e;#t;#o;#n;#i;constructor(e,t){this.#i=g(),this.#o=e,this.#n=t?.property,this.#e=new w("",E(t?.textBoxStyle,{font:d.FontFamily,color:d.Widget.FontColor,size:d.Note.FontSize})),this.Set(t?.value===void 0?"":t?.value),this.#t=t?.callback,this.#n!==void 0&&this.#o.addPropertyChangeListener(this.#n,(o,i)=>{this.Set(i)})}Size(){return this.#i}Set(e){this.#e.get()!==e&&(this.#e.set(e),this.#n!==void 0&&this.#o.setProperty(this.#n,e),this.#t!==void 0&&this.#t(e))}ClickStart(){}ClickEnd(){}Draw(e,t,o,i){this.#e.size(e,o,this.#i);let n={Position:{x:0,y:0},Size:this.#i};return p(n.Position,t),this.#e.size(e,1,this.#i),e.textAlign="left",this.#e.render(e,o,n.Position),n}};var Ie=class{#e;constructor(){this.#e=new Map}register(e,t){this.#e.set(e,t)}create(e,t,o){let i=this.#e.get(t);if(i===void 0)throw new Error("no builder registered for widget: "+t);return i(e,o)}},I=new Ie;I.register("button",(s,e)=>new j(e));I.register("number",(s,e)=>new _(s,e));I.register("color",(s,e)=>new Y(s,e));I.register("slider",(s,e)=>new $(s,e));I.register("string",(s,e)=>new X(s,e));I.register("toggle",(s,e)=>new q(s,e));I.register("image",(s,e)=>new K(e));I.register("text",(s,e)=>new me(s,e));function Ke(s,e,t,o){return i=>{let n="#00FF00";i.outPort!==null?n=i.outPort.filledStyleColor():i.inPort!==null&&(n=i.inPort.filledStyleColor());let r=s*i.graphScale;e!==void 0&&(n=e),(i.mouseOver||i.inNode?.selected()||i.outNode?.selected())&&(r=t*i.graphScale,i.ctx.shadowBlur=25*i.graphScale,o!==void 0&&(n=o),i.ctx.shadowColor=n),i.ctx.strokeStyle=n,i.ctx.lineWidth=r,i.ctx.beginPath(),i.ctx.moveTo(i.start.x,i.start.y);let l=(i.start.x+i.end.x)/2;i.ctx.bezierCurveTo(l,i.start.y,l,i.end.y,i.end.x,i.end.y),i.ctx.stroke(),i.ctx.shadowBlur=0}}var he=class{#e;#t;#o;#n;#i;#r;#s;constructor(e,t,o,i,n){this.#o=e,this.#n=t,this.#i=o,this.#r=i,this.#s=n,this.#e=g(),this.#t=g(),e!==null&&e.inputPort(this.#n).addConnection(this),o!==null&&o.outputPort(this.#r).addConnection(this)}render(e,t,o,i){if(!(this.#o===null&&this.#i===null)){if(this.#o!==null){let n=this.#o.inputPortPosition(this.#n);if(n===void 0)return;ze(n,this.#e)}else if(i!==void 0)this.#e.x=i.x,this.#e.y=i.y;else return;if(this.#i!==null){let n=this.#i.outputPortPosition(this.#r);if(n===void 0)return;ze(n,this.#t)}else if(i!==void 0)this.#t.x=i.x,this.#t.y=i.y;else return;this.#s({ctx:e,start:this.#e,end:this.#t,graphScale:t,mouseOver:o,inPort:this.inPort(),inNode:this.#o,outPort:this.outPort(),outNode:this.#i})}}inNode(){return this.#o}outNode(){return this.#i}clearPort(e){if(this.#o!==null){let t=this.#o.inputPortPosition(this.#n);t!==void 0&&x(t,e)&&this.clearInput()}if(this.#i!==null){let t=this.#i.outputPortPosition(this.#r);t!==void 0&&x(t,e)&&this.clearOutput()}}clearPorts(){this.clearInput(),this.clearOutput()}setInput(e,t){this.#o=e,this.#n=t,this.#o.inputPort(t).addConnection(this)}setOutput(e,t){this.#i=e,this.#r=t,this.#i.outputPort(t).addConnection(this)}clearInput(){this.#o?.inputPort(this.#n).clearConnection(this),this.#o=null,this.#n=-1}clearOutput(){this.#i?.outputPort(this.#r).clearConnection(this),this.#i=null,this.#r=-1}mouseOverPort(e){if(this.#o!==null){let t=this.#o.inputPortPosition(this.#n);if(t!==void 0&&x(t,e))return this.#o.inputPort(this.#n)}if(this.#i!==null){let t=this.#i.outputPortPosition(this.#r);if(t!==void 0&&x(t,e))return this.#i.outputPort(this.#r)}return null}outPort(){return this.#i===null?null:this.#i.outputPort(this.#r)}inPort(){return this.#o===null?null:this.#o.inputPort(this.#n)}referencesNode(e){return this.#o===e||this.#i===e}};var oe=class{zoom;position;constructor(){this.zoom=1,this.position=g()}screenSpaceToGraphSpace(e,t){let o=this.zoom;t.x=e.x/o-this.position.x/o,t.y=e.y/o-this.position.y/o}graphSpaceToScreenSpace(e,t){t.x=this.position.x+e.x*this.zoom,t.y=this.position.y+e.y*this.zoom}reset(){this.zoom=1,this.position.x=0,this.position.y=0}};function Je(s,e,t,o,i,n){let r=s.connectedInputsNodeReferencesByIndex(o);for(let l=0;l<r.length;l++){let h=t.get(r[l]);!n.has(r[l])||(e[h]=i,Je(s,e,t,h,i-1,n))}}function Qe(s,e,t,o,i,n){let r=s.connectedInputsNodeReferencesByIndex(o);for(let l=0;l<r.length;l++){let h=t.get(r[l]);!n.has(r[l])||(e[h]=i,Qe(s,e,t,h,i+1,n))}}function De(s,e,t){let o=e.getNodes(),i=new Map,n=new Array(o.length),r=new Array(o.length),l=new Array(o.length),h=new Map;if(t){if(t.length<2)return;for(let a=0;a<t.length;a++)h.set(o[t[a]],!0)}else for(let a=0;a<o.length;a++)h.set(o[a],!0);let u=new oe;for(let a=0;a<o.length;a++)n[a]=o[a].calculateBounds(s,u),r[a]=new Array(o.length),i.set(o[a],a),l[a]=!1;for(let a=0;a<o.length;a++)r[a][a]=0,Je(e,r[a],i,a,-1,h),Qe(e,r[a],i,a,1,h);let c=new Array(h.size),f=0;for(let a=0;a<o.length;a++){if(!h.has(o[a]))continue;let y=0,M=0;for(let b=0;b<o.length;b++){let U=r[a][b];U!==void 0&&(y=Math.min(y,U),M=Math.max(M,U))}c[f]={length:M-y,node:a,min:y,max:M},f++}c.sort((a,y)=>y.length-a.length);let m=Array(c[0].length+1);for(let a=0;a<m.length;a++)m[a]={Nodes:new Array,Width:0};for(let a=0;a<c.length;a++){let y=c[a];if(l[y.node]===!0)continue;let M=r[y.node];for(let b=0;b<M.length;b++){let U=M[b];if(U===void 0||l[b]===!0)continue;let ke=n[b],Pe=m[U-y.min];Pe.Nodes.push(o[b]),Pe.Width=Math.max(Pe.Width,ke.Size.x),l[b]=!0}}let V=0;for(let a=0;a<m.length;a++)V+=m[a].Width;let k=100,F=50,G=0;for(let a=0;a<m.length;a++){var T=m[a];let y=0;G-=k+T.Width;for(let M=0;M<T.Nodes.length;M++){let b=T.Nodes[M],U=n[i.get(b)],ke={x:G+V+m.length*k,y};y+=U.Size.y+F,b.setPosition(ke)}}}function J(s,e){let t=s+"_Start",o=s+"_End";performance.mark(t),e(),performance.mark(o),performance.measure(s,t,o)}var ie=class{#e;#t;#o;#n;constructor(e){if(this.#e=e?.name===void 0?"Unknown":e.name,this.#t=e?.description===void 0?"":e.description,this.#o=e?.version===void 0?"v0.0.0":e.version,this.#n=new Map,e?.nodes!==void 0)for(let t in e.nodes)this.register(t,e.nodes[t])}nodes(){return this.#n}register(e,t){this.#n.set(e,t)}#i(e,t,o,i){let n=[],r=new Map;for(let[h,u]of o){let c=h.split("/");if(c.length===1)n.push({name:h,callback:()=>{let f=new O(u);f.setPosition(i),e.addNode(f)}});else{r.has(c[0])||r.set(c[0],new Map);let f=r.get(c[0]);c.shift(),f?.set(c.join("/"),u)}}let l=[];for(let[h,u]of r)l.push(this.#i(e,h,u,i));return{name:t,items:n,subMenus:l}}contextMenu(e,t){return this.#i(e,this.#e,this.#n,t)}create(e){let t=this.#n.get(e);if(t===void 0)throw new Error("no builder registered for node: "+e);return new O(t)}};var pe=class{#e;#t;constructor(e){if(this.#e=new Map,this.#t=new Array,e?.onNodeCreated&&this.#t.push(e?.onNodeCreated),e?.publishers!==void 0)for(let t in e.publishers)this.addPublisher(t,new ie(e.publishers[t]))}addOnNodeCreatedListener(e){this.#t.push(e)}addPublisher(e,t){this.#e.set(e,t)}create(e,t){let o=this.#e.get(e);if(o===void 0)throw new Error("no publisher registered with identifier: "+e);let i=o.create(t);for(let n=0;n<this.#t.length;n++){let r=this.#t[n];r(e,t,i)}return i}openMenu(e,t){let o=[];for(let[i,n]of this.#e)o.push(n.contextMenu(e,t));return{name:"New Node",group:P,subMenus:o}}};var P="node-flow-graph-node-menu";function st(s){return s?.renderer!==void 0?s.renderer:Ke(s?.size===void 0?2:s.size,void 0,s?.mouseOverSize===void 0?4:s.mouseOverSize,void 0)}var ye=class{#e;#t;#o;#n;#i;#r;#s;#l;#u;#d;#h;#a;#g;#f;#c;#m;#y;constructor(e){this.#e=[],this.#o=-1,this.#n=new S,this.#i=null,this.#s=null,this.#l=null,this.#u=null,this.#t=new Array,this.#h=new pe(e?.nodes),this.#r=st(e?.idleConnection),this.#y=new Array,this.#a=!1,this.#g=g(),this.#f=g(),this.#c=new S,this.#m=new W({border:{color:d.BoxSelect.Color,size:d.BoxSelect.Size},color:"rgba(0,0,0,0)",radius:d.BoxSelect.Radius})}addPublisher(e,t){this.#h.addPublisher(e,t)}addOnNodeCreatedListener(e){this.#h.addOnNodeCreatedListener(e)}addOnNodeAddedListener(e){this.#y.push(e)}clickStart(e,t,o){this.#a=!1;let i=!1;if(this.#o>-1){this.#V(this.#o,!o);for(let n=0;n<this.#e.length;n++)this.#e[n].selected()&&this.#n.Push(n);i=!0}if(this.#l!==null&&(this.#l.ClickStart(),this.#u=this.#l,i=!0),this.#s===null)return o&&!i&&(t.screenSpaceToGraphSpace(e,this.#g),p(this.#f,this.#g),this.#a=!0),i||o;if(this.#s.InputPort){for(let n=0;n<this.#t.length;n++)if(this.#t[n].inPort()===this.#s.Port){this.#t[n].clearInput(),this.#i=this.#t[n];break}}else{let n=this.#s.Node,r=this.#s.Index,l=this.#s.Node,h=this.#s.Index;this.#s.InputPort?(l=null,h=-1):(n=null,r=-1);let u=new he(n,r,l,h,this.#r);this.#i=u,this.#t.push(u)}return!0}mouseDragEvent(e,t){let o=!1;return C.run(()=>{let i=C.get();if(i.x=e.x/t,i.y=e.y/t,ne(this.#f,this.#f,i),this.#x())for(let n=0;n<this.#n.Count();n++){let r=this.#e[this.#n.At(n)];r.locked()||(r.translate(i),o=!0)}}),o?!0:this.#p()||this.#b()||this.#a}clearNodeInputConnection(e,t){let o=e.inputPort(t);for(let i=this.#t.length-1;i>=0;i--)this.#t[i].inPort()===o&&this.#N(this.#t[i])}clickEnd(){if(this.#n.Clear(),this.#a){for(let o=0;o<this.#c.Count();o++)this.#B(this.#e[this.#c.At(o)],!1);this.#c.Clear(),this.#a=!1}if(this.#u!==null&&(this.#u.ClickEnd(),this.#u=null),this.#i===null)return;if(this.#s===null){this.#k();return}let e=this.#s.Port,t=this.#i;if(e===t.inPort()||e===t.outPort()){this.#k();return}if(this.#s.InputPort&&t.inPort()!==null){this.#k();return}if(!this.#s.InputPort&&t.outPort()!==null){this.#k();return}if(this.#s.InputPort&&this.#s.Port.getDataType()!==t.outPort()?.getDataType()){this.#k();return}if(!this.#s.InputPort&&this.#s.Port.getDataType()!==t.inPort()?.getDataType()){this.#k();return}this.#s.InputPort?(this.#s.Port.getPortType()!=="INPUTARRAY"&&this.clearNodeInputConnection(this.#s.Node,this.#s.Index),t.setInput(this.#s.Node,this.#s.Index)):t.setOutput(this.#s.Node,this.#s.Index),this.#i=null}connectNodes(e,t,o,i){let n=e.outputPort(t).getDataType(),r=o.inputPort(i).getDataType();if(n!==r){console.error("can't connect nodes of different types",n,r);return}let l=new he(o,i,e,t,this.#r);return this.#t.push(l),l}getNodes(){return this.#e}connectedInputsNodeReferencesByIndex(e){return this.connectedInputsNodeReferences(this.#e[e])}connectedInputsNodeReferences(e){let t=new Array;for(let o=0;o<this.#t.length;o++){let i=this.#t[o];if(e!==i.inNode())continue;let n=i.outNode();n!==null&&t.push(n)}return t}connectedOutputsNodeReferences(e){let t=this.#e[e],o=new Array;for(let i=0;i<this.#t.length;i++){let n=this.#t[i];if(t!==n.outNode())continue;let r=n.inNode();r!==null&&o.push(r)}return o}addNode(e){this.#e.push(e);for(let t=0;t<this.#y.length;t++){let o=this.#y[t];!o||o(e)}}fileDrop(e){return this.#o===-1?!1:(this.#e[this.#o].dropFile(e),!0)}#C(e){if(e>=this.#e.length||e<0){console.error("invalid node connection");return}for(let t=this.#t.length-1;t>=0;t--)this.#t[t].referencesNode(this.#e[e])&&this.#w(t)}#x(){return this.#n.Count()>0}#p(){return this.#i!==null}#b(){return this.#u!==null}#S(e){this.#C(e),this.#e.splice(e,1)}#w(e){this.#t[e].clearPorts(),this.#t.splice(e,1)}#N(e){let t=this.#t.indexOf(e);t>-1?this.#w(t):console.error("no connection found to remove")}organize(e){De(e,this)}#v(){let e=new Array;for(let t=0;t<this.#e.length;t++)this.#e[t].selected()&&e.push(t);return e}#T(e){De(e,this,this.#v())}openContextMenu(e,t){let o={name:"Organize",group:P,items:[{name:"All Nodes",group:P,callback:()=>{this.organize(e)}}]},i={items:[],subMenus:[o,this.#h.openMenu(this,t)]};if(this.#v().length>0&&o.items?.push({name:"Selected Nodes",group:P,callback:()=>{this.#T(e)}}),this.#o>-1){let n=this.#o,r=this.#e[n];i.subMenus?.push({group:P,name:"Select",items:[{name:"Direct Connected Nodes",group:P,callback:()=>{this.#z(n)}},{name:"Input Nodes + Descendents",group:P,callback:()=>{this.#P(r)}}]}),i.subMenus?.push({group:P,name:"Delete",items:[{name:"Node",group:P,callback:()=>{this.#S(n)}},{name:"Connections",group:P,callback:()=>{this.#C(n)}}]}),i=Z(i,r.contextMenu())}return i}#P(e){if(e===void 0)return;this.#B(e,!1);let t=this.connectedInputsNodeReferences(e);for(let o=0;o<t.length;o++)this.#P(t[o])}#z(e){let t=this.#e[e];if(t===void 0)return;this.#B(t,!1);let o=this.connectedOutputsNodeReferences(e);for(let n=0;n<o.length;n++)this.#B(o[n],!1);let i=this.connectedInputsNodeReferencesByIndex(e);for(let n=0;n<i.length;n++)this.#B(i[n],!1)}#V(e,t){this.#B(this.#e[e],t)}#B(e,t){if(e.select(),!!t)for(let o=0;o<this.#e.length;o++)e!==this.#e[o]&&this.#e[o].unselect()}#k(){this.#i!==null&&(this.#N(this.#i),this.#i=null)}#M(e,t,o){for(let i=0;i<this.#t.length;i++){let n=!1;o!==void 0&&(n=this.#t[i].mouseOverPort(o)!==null),this.#t[i].render(e,t.zoom,n,o)}}#A(e,t,o){this.#s=null,this.#l=null,this.#o=-1,this.#c.Clear();let i=this.#F(t);for(let n=0;n<this.#e.length;n++){let r=0;if(o!==void 0&&!this.#a){let l=this.#e[n].inBounds(e,t,o);l.Node!==void 0&&l.PortIndex===void 0&&l.Widget===void 0&&(r=1,this.#o=n,this.#d="grab"),l.Widget!==void 0&&(this.#l=l.Widget,this.#d="pointer"),l.Port!==void 0&&l.Node!==void 0&&l.PortIndex!==void 0&&l.PortIsInput!==void 0&&(this.#s={Index:l.PortIndex,Node:l.Node,Port:l.Port,InputPort:l.PortIsInput})}else if(this.#a){let l=this.#e[n].calculateBounds(e,t);Oe(i,l)&&(r=1,this.#c.Push(n))}this.#e[n].selected()&&this.#n.Count()>0&&(r=2,this.#d="grabbing"),this.#e[n].render(e,t,r,o)}}#F(e){let t={Position:g(),Size:g()};return e.graphSpaceToScreenSpace(this.#g,t.Position),e.graphSpaceToScreenSpace(this.#f,t.Size),ae(t.Size,t.Size,t.Position),t}render(e,t,o){if(this.#d="default",J("Render_Connections",()=>{this.#M(e,t,o)}),J("Render_Nodes",()=>{this.#A(e,t,o)}),this.#a){let i=this.#F(t);e.setLineDash([d.BoxSelect.LineDashLength]),this.#m.Draw(e,i,1),e.setLineDash([])}return{cursorStyle:this.#d}}};function ue(s){let e=new Array,t="Set",o="Cancel";return new R({title:s.title,options:[t,o],content:()=>{let i=document.createElement("div");i.style.flexDirection="column",i.style.display="flex";for(let n=0;n<s.form.length;n++){let r=document.createElement("h4");r.innerText=s.form[n].name,i.append(r);let l=document.createElement("input");l.value=s.form[n].startingValue,l.type=s.form[n].type,i.append(l),e.push(l),i.append(document.createElement("br"))}return i},onClose:i=>{if(i!==t||e===null){s.onCancel&&s.onCancel();return}let n=new Array;for(let r=0;r<s.form.length;r++)n[r]=e[r]?.value;s.onUpdate(n)}})}var Ee=150;var O=class{#e;#t;#o;#n;#i;#r;#s;#l;#u;#d;#h;#a;#g;#f;#c;#m;#y;#C;#x;#p;#b;#S;#w;#N;#v;constructor(e){if(this.#o=new Array,this.#n=new Array,this.#i=new Array,this.#p=new S,this.#b=new S,this.#S=new S,this.#C=15,this.#r=e?.locked===void 0?!1:e.locked,this.#w=e?.data===void 0?{}:e?.data,this.#v=new Map,this.#N=new Array,this.#s=e?.canEdit===void 0?!1:e.canEdit,this.#l=e?.contextMenu===void 0?null:e.contextMenu,this.#u=e?.metadata,this.#x=!1,this.#d=new Array,this.#h=new Array,this.#a=new Array,e?.onSelect&&this.#d.push(e?.onSelect),e?.onUnselect&&this.#h.push(e?.onUnselect),e?.onFileDrop&&this.#a.push(e?.onFileDrop),this.#e=e?.position===void 0?{x:0,y:0}:e.position,this.#t=new w(e?.title===void 0?"":e.title,E(e?.style?.title?.textStyle,{size:16,weight:"bold",color:d.Node.FontColor})),this.#g=e?.style?.title?.color===void 0?"#154050":e?.style?.title?.color,this.#m=e?.style?.title?.padding===void 0?15:e?.style?.title?.padding,this.#c=new Map,this.#c.set(0,new W(Q(e?.style?.idle,{border:{color:d.Node.Border.Idle,size:1},radius:d.Node.BorderRadius,color:d.Node.BackgroundColor}))),this.#c.set(1,new W(Q(e?.style?.mouseOver,{border:{color:d.Node.Border.MouseOver,size:1.1},radius:d.Node.BorderRadius,color:d.Node.BackgroundColor}))),this.#c.set(2,new W(Q(e?.style?.grabbed,{border:{color:d.Node.Border.Grabbed,size:2},radius:d.Node.BorderRadius,color:d.Node.BackgroundColor}))),this.#f=new W(Q(e?.style?.selected,{border:{color:d.Node.Border.Selected,size:1},radius:d.Node.BorderRadius,color:d.Node.BackgroundColor})),this.#y=new A({size:e?.style?.portText?.size===void 0?14:e?.style?.portText?.size,color:e?.style?.portText?.color===void 0?d.Node.Port.FontColor:e?.style?.portText?.color,font:e?.style?.portText?.font,weight:e?.style?.portText?.weight}),e?.inputs!==void 0)for(let t=0;t<e.inputs.length;t++)this.addInput(e.inputs[t]);if(e?.outputs!==void 0)for(let t=0;t<e.outputs.length;t++)this.addOutput(e.outputs[t]);if(e?.widgets!==void 0)for(let t=0;t<e.widgets.length;t++){let o=e.widgets[t];o.type!==void 0&&this.addWidget(I.create(this,o.type,o.config))}}metadata(){return this.#u}selected(){return this.#x}select(){if(!this.#x){this.#x=!0;for(let e=0;e<this.#d.length;e++)this.#d[e]()}}addAnyPropertyChangeListener(e){e==null,this.#N.push(e)}addPropertyChangeListener(e,t){this.#v.has(e)||this.#v.set(e,[]);let o=this.#v.get(e);o!==void 0&&o.push(t)}setProperty(e,t){let o=this.#w[e];if(o===t)return;this.#w[e]=t;for(let n=0;n<this.#N.length;n++)this.#N[n](e,o,t);let i=this.#v.get(e);if(i!==void 0)for(let n=0;n<i.length;n++)i[n](o,t)}getProperty(e){return this.#w[e]}#T(){de({title:"Set Node Title",startingValue:this.title(),onUpdate:e=>{this.setTitle(e)}}).Show()}#P(){de({title:"New Button Widget Text",startingValue:"My Button",onUpdate:e=>{this.addWidget(new j({text:e}))}}).Show()}#z(){return{name:"Widget",items:[{name:"Button",callback:this.#P.bind(this)},{name:"Number",callback:()=>{this.addWidget(new _(this))}},{name:"Color",callback:()=>{this.addWidget(new Y(this))}},{name:"Slider",callback:()=>{ue({title:"New Slider",form:[{name:"min",type:"number",startingValue:0},{name:"max",type:"number",startingValue:100}],onUpdate:e=>{this.addWidget(new $(this,{min:e[0],max:e[1]}))}}).Show()}},{name:"String",callback:()=>{this.addWidget(new X(this))}},{name:"Toggle",callback:()=>{this.addWidget(new q(this))}},{name:"Image",callback:()=>{ue({title:"New Image",form:[{name:"URL",type:"text",startingValue:"https://pbs.twimg.com/media/GYabtu6bsAA7m99?format=jpg&name=medium"},{name:"Max Width",type:"number",startingValue:Ee},{name:"Max Height",type:"number",startingValue:Ee}],onUpdate:e=>{this.addWidget(new K({image:e[0],maxWidth:e[1],maxHeight:e[2]}))}}).Show()}}]}}contextMenu(){let e={group:P,items:[],subMenus:[]};return this.canEdit()&&e.subMenus?.push({group:P,name:"Edit",items:[{name:"Title",callback:()=>{this.#T()}}],subMenus:[{name:"Add",items:[{name:"Input",callback:()=>{ue({title:"New Input",form:[{name:"name",type:"text",startingValue:"input"},{name:"type",type:"text",startingValue:"string"}],onUpdate:t=>{this.addInput({name:t[0],type:t[1]})}}).Show()}},{name:"Output",callback:()=>{ue({title:"New Output",form:[{name:"name",type:"text",startingValue:"output"},{name:"type",type:"text",startingValue:"string"}],onUpdate:t=>{this.addOutput({name:t[0],type:t[1]})}}).Show()}}],subMenus:[this.#z()]}]}),this.locked()?e.items?.push({name:"Unlock Node Position",group:P,callback:this.unlock.bind(this)}):e.items?.push({name:"Lock Node Position",group:P,callback:this.lock.bind(this)}),this.#l!==null&&(e=Z(e,this.#l)),e}unselect(){if(!!this.#x){this.#x=!1;for(let e=0;e<this.#h.length;e++)this.#h[e]()}}addUnselectListener(e){this.#h.push(e)}addSelectListener(e){this.#d.push(e)}dropFile(e){for(let t=0;t<this.#a.length;t++)this.#a[t](e)}addFileDropListener(e){this.#a.push(e)}locked(){return this.#r}lock(){this.#r=!0}unlock(){this.#r=!1}setPosition(e){p(this.#e,e)}calculateBounds(e,t){let o=g(),i=this.#m*2,n=g();t.graphSpaceToScreenSpace(this.#e,n);let r=g();this.#t.size(e,1,r),r.x+=i,r.y+=i+this.#C*this.#o.length;for(let l=0;l<this.#o.length;l++){let h=this.#o[l];this.#y.measure(e,1,h.getDisplayName(),o),r.y+=o.y,r.x=Math.max(r.x,o.x+i)}r.y+=this.#C*this.#n.length;for(let l=0;l<this.#n.length;l++){let h=this.#n[l];this.#y.measure(e,1,h.getDisplayName(),o),r.y+=o.y,r.x=Math.max(r.x,o.x+i)}r.y+=this.#C*this.#i.length;for(let l=0;l<this.#i.length;l++){let u=this.#i[l].Size();r.y+=u.y,r.x=Math.max(r.x,u.x+i)}return r.y+=this.#C,r.x=Math.max(r.x,Ee),r.x*=t.zoom,r.y*=t.zoom,{Position:n,Size:r}}addInput(e){let t=new se(this,e.array?"INPUTARRAY":"INPUT",e);return this.#o.push(t),t}addOutput(e){let t=new se(this,"OUTPUT",e);return this.#n.push(t),t}addWidget(e){this.#i.push(e)}getWidget(e){return this.#i[e]}widgetCount(){return this.#i.length}translate(e){this.#e.x+=e.x,this.#e.y+=e.y}inBounds(e,t,o){var i={};let n=this.calculateBounds(e,t);x(n,o)&&(i.Node=this);for(let r=0;r<this.#p.Count();r++)x(this.#p.At(r),o)&&(i.Node=this,i.PortIndex=r,i.PortIsInput=!0,i.Port=this.#o[r]);for(let r=0;r<this.#b.Count();r++)x(this.#b.At(r),o)&&(i.Node=this,i.PortIndex=r,i.PortIsInput=!1,i.Port=this.#n[r]);for(let r=0;r<this.#S.Count();r++)x(this.#S.At(r),o)&&(i.Node=this,i.WidgetIndex=r,i.Widget=this.#i[r]);return i}canEdit(){return this.#s}title(){return this.#t.get()}setTitle(e){this.#t.set(e)}inputPortPosition(e){return this.#p.At(e)}inputPort(e){return this.#o[e]}inputs(){return this.#o.length}outputPortPosition(e){return this.#b.At(e)}outputPort(e){return this.#n[e]}outputs(){return this.#n.length}#V(e){if(this.#x&&e===0)return this.#f;let t=this.#c.get(e);if(t===void 0)throw new Error("no registered border style for state: "+e);return t}render(e,t,o,i){C.run(()=>{let n=C.get();this.#p.Clear(),this.#b.Clear(),this.#S.Clear();let r=this.#m*t.zoom,l=this.#C*t.zoom,h=this.calculateBounds(e,t),u=this.#V(o);u.Draw(e,h,t.zoom);let c=u.borderSize();e.textAlign="center",e.textBaseline="middle";let f=C.get();this.#t.size(e,t.zoom,f);let m=C.get();m.x=h.Size.x,m.y=f.y+r*2,e.fillStyle=this.#g,e.beginPath(),e.roundRect(h.Position.x+c*t.zoom*.5,h.Position.y+c*t.zoom*.5,m.x-c*t.zoom,m.y-c*t.zoom*.5,[u.radius()*t.zoom,u.radius()*t.zoom,0,0]),e.fill();let V=C.get();V.x=h.Position.x+h.Size.x/2,V.y=h.Position.y+r+f.y/2,this.#t.render(e,t.zoom,V);let k=h.Position.y+r*2+f.y+l,F=h.Position.x+r;e.textAlign="left";for(let T=0;T<this.#o.length;T++){let a=this.#o[T];this.#y.measure(e,t.zoom,a.getDisplayName(),n);let y=C.get();y.x=h.Position.x,y.y=k+n.y/2,this.#y.setupStyle(e,t.zoom),e.fillText(a.getDisplayName(),F,y.y),this.#p.Push(a.render(e,y,t,i)),k+=n.y+l}let G=h.Position.x+h.Size.x;e.textAlign="right";for(let T=0;T<this.#n.length;T++){let a=this.#n[T];this.#y.measure(e,t.zoom,a.getDisplayName(),n);let y=C.get();y.x=G,y.y=k+n.y/2,this.#y.setupStyle(e,t.zoom),e.fillText(a.getDisplayName(),G-r,y.y),this.#b.Push(a.render(e,y,t,i)),k+=n.y+l}for(let T=0;T<this.#i.length;T++){let a=this.#i[T],y=a.Size(),M=y.x*t.zoom,b=C.get();b.x=h.Position.x+(h.Size.x-M)/2,b.y=k,this.#S.Push(a.Draw(e,b,t.zoom,i)),k+=y.y*t.zoom+l}})}};var xe=class{#e;#t;#o;#n;constructor(e,t,o,i){this.#e=e,this.#t=t,this.#o=o,this.#n=i}type(){return this.#e}lexeme(){return this.#t}tokenStart(){return this.#o}tokenEnd(){return this.#n}};var Ce=class{#e;#t;#o;constructor(e){this.#t=0,this.#e=e,this.#o=new Array}tokens(){return this.#o}#n(){return this.#t>this.#e.length-1?"":this.#e.charAt(this.#t)}#i(){this.#t++}#r(){return this.#t++,this.#t>this.#e.length-1?"":this.#e.charAt(this.#t)}#s=0;#l(e,t){this.#o.push(new xe(e,t,this.#s,this.#t)),this.#s=this.#t}#u(){this.#r()==="#"?(this.#l("H3","###"),this.#i()):this.#l("H2","##")}#d(){this.#r()==="#"?this.#u():this.#l("H1","#")}#h(){let e=this.#n();for(;e!==""&&!(e!==" "&&e!=="	");)e=this.#r();this.#l("Space"," ")}#a(){let e=this.#n(),t=-1;for(;e!=="";){if((e===" "||e==="	")&&t===-1){this.#i();continue}if(e===`
`||e==="*"||e==="`"){t!=-1&&this.#l("Text",this.#e.substring(t,this.#t));return}t===-1&&(t=this.#t),e=this.#r()}t!=-1&&this.#l("Text",this.#e.substring(t,this.#t))}parse(){let e=this.#n();for(;e!=="";)e===" "||e==="	"?this.#h():e==="#"?this.#d():e===`
`?(this.#l("New Line",`
`),this.#i()):e==="*"?(this.#l("Star","*"),this.#i()):e==="`"?(this.#l("`","`"),this.#i()):this.#a(),e=this.#n()}};var be=class{#e;#t;#o;#n;constructor(e){this.#e=e,this.#n=-1,this.#o=new S,this.#t=new S,document.fonts.addEventListener("loadingdone",t=>{this.#n=-1})}#i(e,t){if(this.#n===t)return;let o=t;o-=d.Note.CodeBlock.Padding*2,this.#o.Clear(),this.#t.Clear();let i=0,n=this.#e.style().getSize()+d.Note.LineSpacing,r=this.#e.split(`
`);for(let l=0;l<r.length;l++){let u=r[l].breakIntoLines(e,o);for(let c=0;c<u.length;c++)this.#o.Push(u[c]),this.#t.Push({x:0,y:i}),i+=n}this.#n=t}render(e,t,o,i){this.#i(e,i);let n=d.Note.CodeBlock.Padding*o,r=0;for(let h=0;h<this.#o.Count();h++){let u=this.#t.At(h);r=Math.max(r,u.y*o)}let l=t.y+r+o*5;e.fillStyle=d.Note.CodeBlock.BackgroundColor,e.beginPath(),e.roundRect(t.x,t.y,i*o,r+n*2,d.Note.CodeBlock.BorderRadius*o),e.fill();for(let h=0;h<this.#o.Count();h++){let u=this.#o.At(h),c=this.#t.At(h);u.render(e,o,{x:c.x*o+t.x+n,y:c.y*o+t.y+n}),r=Math.max(r,c.y*o)}return r+n*2}},Se=class{#e;constructor(e){this.#e=e}render(e,t,o,i){let n=0,r=20,l={x:t.x+r*o,y:t.y},h=d.Note.DotSize*o;for(let u=0;u<this.#e.length;u++)e.beginPath(),e.arc(t.x+h,l.y+h*3,h,0,2*Math.PI),e.fill(),n+=this.#e[u].render(e,l,o,i-r)+o*d.Note.LineSpacing*2,l.y=t.y+n;return n}},L=class{#e;#t;#o;#n;#i;#r;constructor(e,t,o){this.#o=e,this.#e=t,this.#t=o,this.#r=-1,this.#i=new S,this.#n=new S,document.fonts.addEventListener("loadingdone",i=>{this.#r=-1})}#s(e,t){if(this.#r===t)return;let o=t;this.#t&&(o-=d.Note.CodeBlock.Padding*2),this.#i.Clear(),this.#n.Clear();let i=g(),n=g(),r=0,l=new S,h=new S;for(let u=0;u<this.#o.length;u++){let f=this.#o[u].splitAtWidth(e,o-i.x),m=0;for(;f.length>1&&m<100;){if(m++,f[0].get()===""&&l.Count()===0)if(f[1].get().length===1){f[0]=f[1];break}else f=f[1].splitAtIndex(1);f[0].get()!==""&&(f[0].size(e,1,n),r=Math.max(r,n.y),l.Push(f[0]),h.Push(i.x)),i.y+=r;for(let V=0;V<l.Count();V++)this.#i.Push(l.At(V)),this.#n.Push({x:h.At(V),y:i.y});l.Clear(),h.Clear(),i.y+=d.Note.LineSpacing,r=0,i.x=0,f=f[1].splitAtWidth(e,o)}m===100&&console.log(f),f[0].size(e,1,n),r=Math.max(r,n.y),l.Push(f[0]),h.Push(i.x),i.x+=n.x}i.y+=r;for(let u=0;u<l.Count();u++)this.#i.Push(l.At(u)),this.#n.Push({x:h.At(u),y:i.y});this.#r=t}render(e,t,o,i){this.#s(e,i);let n=0;if(this.#t&&(n+=d.Note.CodeBlock.Padding*o),this.#t){let l=0;for(let u=0;u<this.#i.Count();u++){let c=this.#n.At(u);l=Math.max(l,c.y*o)}let h=t.y+l+o*5;e.fillStyle=d.Note.CodeBlock.BackgroundColor,e.beginPath(),e.roundRect(t.x,t.y,i*o,l+n*2,d.Note.CodeBlock.BorderRadius*o),e.fill()}let r=0;for(let l=0;l<this.#i.Count();l++){let h=this.#i.At(l),u=this.#n.At(l);h.render(e,o,{x:u.x*o+t.x+n,y:u.y*o+t.y+n}),r=Math.max(r,u.y*o)}if(this.#e){let l=t.y+r+o*5;e.strokeStyle=d.Note.FontColor,e.lineWidth=d.Note.HeaderLineWidth*o,e.beginPath(),e.moveTo(t.x,l),e.lineTo(t.x+i*o,l),e.stroke()}return r+n*2}};var we=class{#e;#t;#o;constructor(e,t){this.#o=e,this.#t=0,this.#e=t}#n(){return this.#t>this.#e.length-1?null:this.#e[this.#t]}#i(){this.#t++}#r(){return this.#t++,this.#t>=this.#e.length-1?null:this.#e[this.#t]}#s(){return this.#t+1>=this.#e.length-1?null:this.#e[this.#t+1]}#l(e){return this.#t+e>=this.#e.length-1?null:this.#e[this.#t+e]}#u(){let e=this.#r();if(e?.type()==="Space")return[new w("*")];let t=!1;for(;e!==null&&e.type()==="Star";)t=!0,e=this.#r();let o="",i=!1,n=!1,r=!1;for(;e!==null&&e.type()!=="New Line";){if(e.type()==="Star"){if(n){i=!0;break}if(n=!0,t===!1)break}if(n&&e.type()!=="Star")break;e.type()==="Text"&&(o+=e.lexeme(),r=!0),e.type()==="Space"&&(o+=e.lexeme(),r=!1),e=this.#r()}let l={};return r&&n&&(i?l.weight="bold":l.style="italic"),[new w(o,l)]}#d(){let e=new Array,t="",o=this.#n();for(;o!==null&&o.type()==="Space";)o=this.#r();for(;o!==null&&o.type()!=="New Line";){switch(o.type()){case"Text":case"H1":case"H2":case"H3":case"Text":case"Space":t+=o.lexeme();break;case"Star":t!==""&&(e.push(new w(t)),t="");let i=this.#u();for(let n=0;n<i.length;n++)e.push(i[n]);break}o=this.#r()}return t!==""&&e.push(new w(t)),e}#h(){this.#i();let e=this.#d();for(let t=0;t<e.length;t++)e[t].setColor(d.Note.FontColor),e[t].setSize(d.Note.H1.FontSize),e[t].setWeight("bold");return new L(e,!0,!1)}#a(){this.#i();let e=this.#d();for(let t=0;t<e.length;t++)e[t].setColor(d.Note.FontColor),e[t].setSize(d.Note.H2.FontSize),e[t].setWeight("bold");return new L(e,!0,!1)}#g(){this.#i();let e=this.#d();for(let t=0;t<e.length;t++)e[t].setColor(d.Note.FontColor),e[t].setSize(d.Note.H3.FontSize),e[t].setWeight("bold");return new L(e,!1,!1)}#f(){if(this.#s()?.type()!=="Space"){let t=this.#d();return this.#c(t),new L(t,!1,!1)}let e=new Array;for(;this.#n()?.type()==="Star"&&this.#s()?.type()==="Space";){this.#i();let t=this.#d();this.#c(t),e.push(new L(t,!1,!1)),this.#i()}return new Se(e)}#c(e){for(let t=0;t<e.length;t++)e[t].setColor(d.Note.FontColor),e[t].setSize(d.Note.FontSize)}#m(){if(this.#s()?.type()!=="`"||this.#l(2)?.type()!=="`"){let r=this.#d();return this.#c(r),new L(r,!1,!1)}this.#i(),this.#i();let e=this.#r();e?.type()==="New Line"&&(e=this.#r());let t=e?.tokenStart(),o=t;for(;e!==null;){if(e.type()==="`"&&this.#s()?.type()==="`"&&this.#l(2)?.type()==="`"){o=e.tokenEnd()-1;break}e=this.#r()}this.#i(),this.#i(),this.#i();let i=this.#o.substring(t,o),n=new w(i);return this.#c([n]),new be(n)}parse(){let e=this.#n(),t=new Array;for(;e!==null;){switch(e.type()){case"H1":t.push(this.#h());break;case"H2":t.push(this.#a());break;case"H3":t.push(this.#g());break;case"Text":let o=this.#d();this.#c(o),t.push(new L(o,!1,!1));break;case"Star":t.push(this.#f());break;case"New Line":this.#i();break;case"`":t.push(this.#m());break;default:this.#i()}e=this.#n()}return t}};function et(s){let e=new Ce(s);return e.parse(),new we(s,e.tokens()).parse()}var ve=20,D=10,ee=class{#e;#t;#o;#n;#i;#r;#s;#l;#u;constructor(e){this.#u=!1,this.#s=e?.locked===void 0?!0:!e?.locked,this.#o=e?.width===void 0?500:e.width,this.#i=e?.position===void 0?{x:0,y:0}:e.position,this.setText(e?.text===void 0?"":e?.text),this.#l={Position:{x:0,y:0},Size:{x:0,y:0}},this.#r=0,this.#n=new W({border:{color:"white",size:1}})}setText(e){this.#e=e,this.#t=et(this.#e)}translate(e){this.#i.x+=e.x,this.#i.y+=e.y}handleSelected(){return this.#r}selectHandle(e){this.#r=e}#d=g();render(e,t,o){if(this.#s&&(this.#u||this.#r!==0)){if(o){if(this.#r===2){let c=this.#i.x*t.zoom+t.position.x;this.#o=Math.max((o.x-c)/t.zoom,1)}else if(this.#r===1){let c=this.#o*t.zoom,f=this.#i.x*t.zoom+t.position.x+c;this.#o=Math.max((f-o.x)/t.zoom,1),this.#i.x=f-this.#o*t.zoom-t.position.x,this.#i.x/=t.zoom}}this.#n.Outline(e,this.leftResizeHandleBox(),t.zoom,2),this.#n.Outline(e,this.rightResizeHandleBox(),t.zoom,2),e.beginPath();let r=this.#l.Position.x,l=this.#l.Position.x+this.#l.Size.x,h=this.#l.Position.y,u=this.#l.Position.y+this.#l.Size.y;e.moveTo(r,h+this.#l.Size.y/2-D),e.lineTo(r,h),e.lineTo(l,h),e.lineTo(l,h+this.#l.Size.y/2-D),e.moveTo(r,u-this.#l.Size.y/2+D),e.lineTo(r,u),e.lineTo(l,u),e.lineTo(l,u-this.#l.Size.y/2+D),e.stroke()}t.graphSpaceToScreenSpace(this.#i,this.#d),p(this.#l.Position,this.#d);let i=this.#d.y,n=d.Note.EntrySpacing*t.zoom;e.textAlign="left",e.textBaseline="alphabetic";for(let r=0;r<this.#t.length;r++){let l=this.#t[r];this.#d.y+=l.render(e,this.#d,t.zoom,this.#o)+n}this.#l.Position.x-=ve,this.#l.Position.y-=ve,this.#l.Size.x=t.zoom*this.#o+ve*2,this.#l.Size.y=this.#d.y-i+ve*2}leftResizeHandleBox(){return{Position:{x:this.#l.Position.x-D/2,y:this.#l.Position.y+this.#l.Size.y/2-D/2},Size:{x:D,y:D}}}rightResizeHandleBox(){return{Position:{x:this.#l.Position.x-D/2+this.#l.Size.x,y:this.#l.Position.y+this.#l.Size.y/2-D/2},Size:{x:D,y:D}}}edittingLayout(){return this.#s}setHovering(e){this.#u=e}editContent(){let e=null,t="Save";new R({title:"Edit Note",options:[t,"Cancel"],content:()=>{let i=document.createElement("div");return e=document.createElement("textarea"),e.rows=8,e.cols=50,e.value=this.#e,i.append(e),i},onClose:i=>{i!==t||e===null||this.setText(e.value)}}).Show()}lock(){this.#s=!1}unlock(){this.#s=!0}bounds(){return this.#l}};var Ne=class{#e;#t;#o;#n;constructor(e){if(this.#n=0,this.#e=[],this.#t=null,this.#o=null,e!==void 0)for(let t=0;t<e.length;t++)this.addNote(new ee(e[t]))}addNote(e){this.#e.push(e)}openContextMenu(e,t){let o="node-flow-graph-note-menu",i={items:[{name:"New Note",group:o,callback:()=>{this.addNote(new ee({text:`#Note

Right-click this note and select "edit note" to put what you want here.`,width:300,position:t}))}}],subMenus:[]};if(this.#t!==null){let n=this.#t;i.items?.push({name:"Delete Note",group:o,callback:()=>{this.#i(n)}},{name:"Edit Note",group:o,callback:n.editContent.bind(n)}),n.edittingLayout()?i.items?.push({name:"Lock Note",group:o,callback:n.lock.bind(n)}):i.items?.push({name:"Unlock Note",group:o,callback:n.unlock.bind(n)})}return i}clickStart(e,t,o){return this.#t!==null&&this.#t.edittingLayout()?(this.#o=this.#t,this.#o.selectHandle(this.#n),!0):!1}clickEnd(){this.#o!==null&&this.#o.selectHandle(0),this.#o=null}mouseDragEvent(e,t){return this.#o===null?!1:(this.#o.handleSelected()||this.#o.translate({x:e.x*(1/t),y:e.y*(1/t)}),!0)}fileDrop(e){return!1}#i(e){let t=this.#e.indexOf(e);t>-1?this.#e.splice(t,1):console.error("no note found to remove")}render(e,t,o){if(this.#t=null,this.#n=0,o)for(let i=0;i<this.#e.length;i++)this.#e[i].setHovering(!1),x(this.#e[i].bounds(),o)&&(this.#t=this.#e[i]);this.#t!=null&&(this.#t.setHovering(!0),o&&(x(this.#t.leftResizeHandleBox(),o)?this.#n=1:x(this.#t.rightResizeHandleBox(),o)&&(this.#n=2)));for(let i=0;i<this.#e.length;i++)this.#e[i].render(e,t,o)}};function ht(s){return(e,t,o,i)=>{t.fillStyle=s,t.fillRect(0,0,e.width,e.height);let n=Math.round(H(i-.3)*255);if(n<=0)return;t.fillStyle=`rgba(41, 54, 57, ${n})`;let r=100,l=2*Math.PI,h=2*i;for(let u=-50;u<50;u++){let c=u*r*i+o.x;for(let f=-50;f<50;f++){let m=f*r*i+o.y;t.beginPath(),t.arc(c,m,h,0,l),t.fill()}}}}var ut="graph-context-menu",Le=class{#e;constructor(e){this.#e=e}clickStart(e,t,o){for(let i=this.#e.length-1;i>=0;i--)if(this.#e[i].clickStart(e,t,o))return}fileDrop(e){for(let t=this.#e.length-1;t>=0;t--)if(this.#e[t].fileDrop(e))return!0;return!1}openContextMenu(e,t){let o={};for(let i=0;i<this.#e.length;i++){let n=this.#e[i].openContextMenu(e,t);n!==null&&(o=Z(o,n))}return o}clickEnd(){for(let e=0;e<this.#e.length;e++)this.#e[e].clickEnd()}mouseDragEvent(e,t){for(let o=0;o<this.#e.length;o++)if(this.#e[o].mouseDragEvent(e,t))return!0;return!1}render(e,t,o){let i={};for(let n=0;n<this.#e.length;n++)J("Render_Subsystem_"+n,()=>{let r=this.#e[n].render(e,t,o);r?.cursorStyle&&(r.cursorStyle=r?.cursorStyle)});return i}},Be=class{#e;#t;#o;#n;#i;#r;#s;#l;#u;#d;#h;#a;constructor(e,t){this.#h=new ye({nodes:t?.nodes,idleConnection:t?.idleConnection}),this.#a=new Ne(t?.notes),this.#u=[new Le([this.#a,this.#h])],this.#d=0,this.#r=new oe,this.#n=Z({items:[{name:"Reset View",group:ut,callback:this.#r.reset.bind(this.#r)}]},t?.contextMenu),this.#s=null,this.#l=null,this.#t=e;let o=e.getContext("2d");if(o===null)throw new Error("could not create canvas context");if(this.#e=o,t?.backgroundRenderer!==void 0)this.#o=t?.backgroundRenderer;else{let i=t?.backgroundColor===void 0?d.Graph.BackgroundColor:t.backgroundColor;this.#o=ht(i)}window.requestAnimationFrame(this.#b.bind(this)),this.#t.addEventListener("wheel",i=>{i.preventDefault(),this.zoom(Math.sign(i.deltaY))},!1),new fe(this.#t,this.#C.bind(this),i=>{this.#i=i},this.#f.bind(this),this.#y.bind(this),this.#m.bind(this),this.#g.bind(this))}#g(e){if(this.currentView().fileDrop(e))return;let t=e.name.split("."),o=t[t.length-1];if(o!=="jpg"&&o!=="jpeg"&&o!=="png")return;let i=g();this.#i&&p(i,this.#c(this.#i)),this.#h.addNode(new O({title:t[0],position:i,widgets:[{type:"image",config:{blob:e}}]}))}zoom(e){let t;if(this.#i&&(t=this.#c(this.#i)),this.#r.zoom+=e*this.#r.zoom*.05,!t||!this.#i)return;let o=this.#c(this.#i);this.#r.position.x+=(o.x-t.x)*this.#r.zoom,this.#r.position.y+=(o.y-t.y)*this.#r.zoom}#f(e,t){if(this.#l!==null){this.#l.click(),this.#s=null,this.#l=null;return}this.#s=null,this.#l=null,this.#i=e,this.currentView().clickStart(e,this.#r,t)}currentView(){return this.#u[this.#d]}organize(){this.#h.organize(this.#e)}addPublisher(e,t){this.#h.addPublisher(e,t)}getNodes(){return this.#h.getNodes()}connectedInputsNodeReferences(e){return this.#h.connectedInputsNodeReferencesByIndex(e)}connectedOutputsNodeReferences(e){return this.#h.connectedOutputsNodeReferences(e)}connectNodes(e,t,o,i){return this.#h.connectNodes(e,t,o,i)}addNode(e){this.#h.addNode(e)}addNote(e){this.#a.addNote(e)}addOnNodeCreatedListener(e){this.#h.addOnNodeCreatedListener(e)}addOnNodeAddedListener(e){this.#h.addOnNodeAddedListener(e)}#c(e){let t=g();return this.#r.screenSpaceToGraphSpace(e,t),t}#m(e){let t=this.#n,o=this.#c(e);t=Z(t,this.currentView().openContextMenu(this.#e,o)),this.#s={Menu:new te(t),Position:o}}#y(){this.currentView().clickEnd()}#C(e){this.currentView().mouseDragEvent(e,this.#r.zoom)||(this.#r.position.x+=e.x,this.#r.position.y+=e.y)}#x;#p;#b(){if(this.#t.parentNode!==null){var e=this.#t.parentNode.getBoundingClientRect();this.#t.width=e.width,this.#t.height=e.height}this.#p="default",J("Render_Background",this.#S.bind(this)),J("Render_View_"+this.#d,()=>{let t=this.currentView().render(this.#e,this.#r,this.#i);t?.cursorStyle&&(this.#p=t?.cursorStyle)}),J("Render_Context",this.#w.bind(this)),this.#x!==this.#p&&(this.#t.style.cursor=this.#p),this.#x=this.#p,window.requestAnimationFrame(this.#b.bind(this))}#S(){this.#o(this.#t,this.#e,this.#r.position,this.#r.zoom)}#w(){C.run(()=>{if(this.#s!==null){let e=C.get();this.#r.graphSpaceToScreenSpace(this.#s.Position,e),this.#l=this.#s.Menu.render(this.#e,e,this.#r.zoom,this.#i),this.#l!==null&&(this.#p="pointer")}})}};globalThis.NodeFlowGraph=Be;globalThis.FlowNode=O;globalThis.NodeFlowTheme=d;globalThis.FlowNote=ee;globalThis.NodePublisher=ie;globalThis.NumberWidget=_;globalThis.ColorWidget=Y;globalThis.StringWidget=X;globalThis.ButtonWidget=j;globalThis.ToggleWidget=q;globalThis.SliderWidget=$;globalThis.ImageWidget=K;globalThis.GlobalWidgetFactory=I;})();
